#include "fanGlobalIncludes.h"

#include "fanISerializable.h"

namespace fan {
	//================================================================================================================================
	//================================================================================================================================
	const std::string ISerializable::GetIndentation(const int _indentLevel) {
		std::stringstream ss;
		for (int indentIndex = 0; indentIndex < _indentLevel; indentIndex++) {
			ss << "    ";
		} 
		return ss.str();
	}

	//================================================================================================================================
	//================================================================================================================================
	void ISerializable::SaveVec2 ( Json & _json, const char * _name, const btVector2&	_vec2 ) {
		_json[_name]["x"] = _vec2[0];
		_json[_name]["y"] = _vec2[1];
	}

	//================================================================================================================================
	//================================================================================================================================
	void ISerializable::SaveVec3 ( Json & _json, const char * _name, const btVector3&	_vec3 ){
		_json[_name]["x"] = _vec3[0];
		_json[_name]["y"] = _vec3[1];
		_json[_name]["z"] = _vec3[2];
	}

	//================================================================================================================================
	//================================================================================================================================
	void ISerializable::SaveQuat ( Json & _json, const char * _name, const btQuaternion& _quat ) {
		_json[_name]["x"] = _quat[0];
		_json[_name]["y"] = _quat[1];
		_json[_name]["z"] = _quat[2];
		_json[_name]["w"] = _quat[3];
	}

	//================================================================================================================================
	//================================================================================================================================
	void ISerializable::SaveColor( Json & _json, const char * _name, const Color&	_color ) {
		_json[_name]["r"] = _color[0];
		_json[_name]["g"] = _color[1];
		_json[_name]["b"] = _color[2];
		_json[_name]["a"] = _color[3];
	}

	//================================================================================================================================
	//================================================================================================================================
	void ISerializable::SaveFloat( Json & _json, const char * _name, const float&	_float ) {
		_json[_name] = _float;
	}

	//================================================================================================================================
	//================================================================================================================================
	void ISerializable::SaveInt  ( Json & _json, const char * _name, const int&	_int ) {
		_json[_name] = _int;
	}

	//================================================================================================================================
	//================================================================================================================================
	void ISerializable::SaveUInt ( Json & _json, const char * _name, const unsigned& _int ) {
		_json[_name] = _int;
	}

	//================================================================================================================================
	//================================================================================================================================
	void ISerializable::SaveBool ( Json & _json, const char * _name, const bool& _bool ) {
		_json[_name] = _bool;
	}

	//================================================================================================================================
	//================================================================================================================================
	void ISerializable::SaveString ( Json & _json, const char * _name, const std::string& _string ) {
		_json[_name] = _string.c_str();
	}

	//================================================================================================================================
	//================================================================================================================================
	bool ISerializable::LoadVec2	( Json & _json, const char * _name, btVector2&		_outVec2 ) {
		Json * token = FindToken(_json, _name );
		if ( token != nullptr ) {
			_outVec2[0] = ( *token )["x"];
			_outVec2[1] = ( *token )["y"];
			return true;
		}
		return false;
	}
	
	//================================================================================================================================
	//================================================================================================================================
	bool ISerializable::LoadVec3	( Json & _json, const char * _name, btVector3&		_outVec3 )	 {
		Json * token = FindToken( _json, _name );
		if ( token != nullptr ) {
			_outVec3[0] = ( *token )["x"];
			_outVec3[1] = ( *token )["y"];
			_outVec3[2] = ( *token )["z"];
			return true;
		}
		return false;
	}
	
	//================================================================================================================================
	//================================================================================================================================
	bool ISerializable::LoadQuat	( Json & _json, const char * _name, btQuaternion&	_outQuat )	 {
		Json * token = FindToken( _json, _name );
		if ( token != nullptr ) {
			_outQuat[0] = ( *token )["x"];
			_outQuat[1] = ( *token )["y"];
			_outQuat[2] = ( *token )["z"];
			_outQuat[3] = ( *token )["w"];
			return true;
		}
		return false;
	}
	
	//================================================================================================================================
	//================================================================================================================================
	bool ISerializable::LoadColor	( Json & _json, const char * _name, Color&			_outColor ) {
		Json * token = FindToken( _json, _name );
		if ( token != nullptr ) {
			_outColor[0] = ( *token )["r"];
			_outColor[1] = ( *token )["g"];
			_outColor[2] = ( *token )["b"];
			_outColor[3] = ( *token )["a"];
			return true;
		}
		return false;
	}
	
	//================================================================================================================================
	//================================================================================================================================
	bool ISerializable::LoadFloat	( Json & _json, const char * _name, float&			_outFloat ) {
		Json * token = FindToken( _json, _name );
		if ( token != nullptr ) {
			_outFloat = ( *token );
			return true;
		}
		return false;
	}
	
	//================================================================================================================================
	//================================================================================================================================
	bool ISerializable::LoadInt		( Json & _json, const char * _name, int&			_outInt )	 {
		Json * token = FindToken( _json, _name );
		if ( token != nullptr ) {
			_outInt = ( *token );
			return true;
		}
		return false;
	}
	
	//================================================================================================================================
	//================================================================================================================================
	bool ISerializable::LoadUInt	( Json & _json, const char * _name, unsigned&		_outUInt ) {
		Json * token = FindToken( _json, _name );
		if ( token != nullptr ) {
			_outUInt = ( *token );
			return true;
		}
		return false;
	}
	
	//================================================================================================================================
	//================================================================================================================================
	bool ISerializable::LoadBool	( Json & _json, const char * _name, bool&			_outBool )	 {
		Json * token = FindToken( _json, _name );
		if ( token != nullptr ) {
			_outBool = ( *token );
			return true;
		}
		return false;
	}
	
	//================================================================================================================================
	//================================================================================================================================
	bool ISerializable::LoadString	( Json & _json, const char * _name, std::string&	_outString ){
		Json * token = FindToken( _json, _name );
		if ( token != nullptr ) {
			_outString = ( *token );
			return true;
		}
		return false;
	}

	//================================================================================================================================
	// returns the json token associated with a name or nullptr if it doesn't exists
	//================================================================================================================================
	Json * ISerializable::FindToken	( Json & _json, const char * _name ) {
		auto it = _json.find( _name );
		if ( it != _json.end() ) {
			return &(*it);
		}
		Debug::Get() << Debug::Severity::warning << "Failed to find token: " << _name << Debug::Endl();
		return nullptr;
	}
}