#include "fanGlobalIncludes.h"
#include "scene/components/fanSphereShape.h"
#include "scene/fanGameobject.h"


namespace fan
{
	REGISTER_EDITOR_COMPONENT( SphereShape );
	REGISTER_TYPE_INFO( SphereShape )

	//================================================================================================================================
	//================================================================================================================================
	void  SphereShape::SetRadius( const float _radius ) {
		GetEcsSphereShape()->Get().setUnscaledRadius( _radius >= 0 ? _radius : 0.f );
	}

	//================================================================================================================================
	//================================================================================================================================
	void SphereShape::OnAttach() {
		ecsSphereShape * sphereShape = GetGameobject()->AddEcsComponent<ecsSphereShape>();
		sphereShape->Init(1.f);
	}

	//================================================================================================================================
	//================================================================================================================================
	void SphereShape::OnDetach() {
		GetGameobject()->RemoveEcsComponent<ecsSphereShape>();
	}


	//================================================================================================================================
	//================================================================================================================================
	void SphereShape::OnGui() {
		Component::OnGui();

		float radius = GetEcsSphereShape()->Get().getRadius();
		if ( ImGui::DragFloat( "radius", &radius, 0.1f, 0.f ) ) {
			SetRadius( radius );
		}
	}

	//================================================================================================================================
	//================================================================================================================================
	bool SphereShape::Load( Json & /*_json*/ ) {
// 		if (!ReadSegmentHeader(_in, "isEnabled:")) { return false; }
// 		if (!ReadBool(_in, m_isEnabled)) { return false; }
		return true;
	}


	//================================================================================================================================
	//================================================================================================================================
	bool SphereShape::Save( Json & _json ) const {
		//SaveBool( jActor, "isEnabled", m_isEnabled );
		Component::Save( _json );
		return true;
	}

	//================================================================================================================================
	//================================================================================================================================
	ecsSphereShape*	SphereShape::GetEcsSphereShape() const {
		return GetGameobject()->GetEcsComponent<ecsSphereShape>();
	}

	//================================================================================================================================
	//================================================================================================================================
	btSphereShape * SphereShape::GetBtShape() {
		return &GetEcsSphereShape()->Get();
	}
}