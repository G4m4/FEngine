#include "fanGlobalIncludes.h"
#include "scene/components/fanBoxShape.h"

#include "scene/fanGameobject.h"


namespace fan {

	REGISTER_EDITOR_COMPONENT( BoxShape );
	REGISTER_TYPE_INFO( BoxShape )

	//================================================================================================================================
	//================================================================================================================================
	void BoxShape::SetHalfExtent( const btVector3 _halfExtent ) {
		GetEcsBoxShape()->Get().setLocalScaling( _halfExtent );
	}

	//================================================================================================================================
	//================================================================================================================================
	void BoxShape::OnAttach() {
		ecsBoxShape * boxShape = GetGameobject()->AddEcsComponent<ecsBoxShape>();
		boxShape->Init( btVector3::One() );
	}

	//================================================================================================================================
	//================================================================================================================================
	void BoxShape::OnDetach() {
		GetGameobject()->RemoveEcsComponent<ecsBoxShape>();
	}

	//================================================================================================================================
	//================================================================================================================================
	void BoxShape::OnGui() {
		Component::OnGui();

		btVector3 halfExtent = GetEcsBoxShape()->Get().getLocalScaling();
		if ( ImGui::DragFloat3("half extent", &halfExtent[0], 0.25f, 0.f ) ) {
			SetHalfExtent( halfExtent );
		}
	}

	//================================================================================================================================
	//================================================================================================================================
	bool BoxShape::Load( Json & /*_json*/ ) {
		// 		if (!ReadSegmentHeader(_in, "isEnabled:")) { return false; }
		// 		if (!ReadBool(_in, m_isEnabled)) { return false; }
		return true;
	}


	//================================================================================================================================
	//================================================================================================================================
	bool BoxShape::Save( Json & _json ) const {
		//SaveBool( jActor, "isEnabled", m_isEnabled );
		Component::Save( _json );
		return true;
	}

	//================================================================================================================================
	//================================================================================================================================
	ecsBoxShape*	BoxShape::GetEcsBoxShape() const {
		return GetGameobject()->GetEcsComponent<ecsBoxShape>();
	}

	//================================================================================================================================
	//================================================================================================================================
	btBoxShape * BoxShape::GetBtShape() {
		return &GetEcsBoxShape()->Get();
	}
}